<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Sugest천es</title>
</head>
<body>

<h1>Sugest천es</h1>

<ul id="lista"></ul>

<button id="prev">Anterior</button>
<button id="next">Pr처xima</button>

<br><br>

<form id="form">
    <input type="text" id="campo" placeholder="Digite a sugest찾o" required>
    <button type="submit">Enviar</button>
</form>

<p id="msg" style="color:green; display:none;"></p>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

const ul = document.getElementById("lista");
const msg = document.getElementById("msg");

let paginaAtual = 1;
let totalPaginas = 1;

function obterPaginaDaURL() {
    const params = new URLSearchParams(window.location.search);
    return parseInt(params.get('page') || '1', 10);
}


function atualizarURL(pagina) {
    const url = new URL(window.location);
    url.searchParams.set('page', pagina);
    window.history.pushState({}, '', url);
}

function carregarSugestoes(pagina) {
    socket.emit("listar", pagina);
}

socket.on("lista", (data) => {
    paginaAtual = data.page;
    totalPaginas = data.totalPages;

    ul.innerHTML = "";
    data.itens.forEach(s => {
        const li = document.createElement("li");
        li.textContent = s.texto;
        ul.appendChild(li);
    });

 
    atualizarURL(paginaAtual);
});

socket.on("criada", (data) => {
    msg.textContent = data.mensagem;
    msg.style.display = "block";
    setTimeout(() => msg.style.display = "none", 2000);
});

document.getElementById("form").addEventListener("submit", (e) => {
    e.preventDefault();
    const texto = document.getElementById("campo").value.trim();
    if (texto) {
        socket.emit("criar", texto);
        document.getElementById("campo").value = "";
    }
});

document.getElementById("prev").onclick = () => {
    if (paginaAtual > 1) {
        carregarSugestoes(paginaAtual - 1);
    }
};

document.getElementById("next").onclick = () => {
    if (paginaAtual < totalPaginas) {
        carregarSugestoes(paginaAtual + 1);
    }
};

const paginaInicial = obterPaginaDaURL();
carregarSugestoes(paginaInicial);
</script>

</body>
</html>

